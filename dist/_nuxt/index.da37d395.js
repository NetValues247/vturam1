import{_ as Q}from"./WelcomeBase.fb4fef78.js";import{v as G,a as P,_ as X}from"./ActiveBoardBase.209f9149.js";import{q as Y,r as u,s as Z,R as ee,S as E,f as te,a as r,h as V,b as l,u as e,w as ae,i as w,K as le,F as se,B as ne,v as T,j as i,t as c,l as R,A as K,k as O,o}from"./entry.bfccc7c4.js";import{f as re}from"./useFormatDigits.ff1e8856.js";import{_ as oe}from"./getAmount.785d5556.js";import{v as ue}from"./vend.90322b11.js";import"./ModalBase.f1cd9c23.js";import"./useStrings.92ef0abb.js";const ie={class:"rounded-md bg-gray-100 p-2"},de={class:"flex flex-wrap justify-between mt-4 px-2"},ce={class:"rounded-md bg-white p-2 mt-3"},pe=["onSubmit"],me={class:"mt-3"},ve=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"Choose Bouquet Plan",-1),be=l("option",{value:"null"},"--Select Bouquet Plan--",-1),fe=["value"],_e={key:0,class:"mt-3"},ye=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"IUC Number",-1),ge={key:1,class:"mt-3"},he=l("label",{for:"subject",class:"block mb-3 font-medium text-lg pl-1"},"Smartcard Number",-1),ke={key:2,class:"animate-pulse font-semibold text-yellow-600"},xe={key:3,class:"mt-1 text-red-600"},we={key:4,class:"mt-1 text-red-600"},Ie={key:5,class:"mt-1 text-red-600"},Se={key:6,class:"mt-1 text-green-600"},Ve={key:7,class:"mt-1 text-green-600"},Te={key:8,class:"mt-1 text-red-600"},Be={class:"mt-3"},Ce=l("label",{for:"sender",class:"block mb-3 font-medium text-lg pl-1"},"Amount ",-1),je={class:"mt-3"},qe=l("label",{for:"sender",class:"block mb-3 font-medium text-lg pl-1"},"Phone (optional)",-1),Ne={key:9,class:"mt-1 text-red-600"},De={key:10,class:"mt-1 text-red-600"},Oe={key:0},Ae={key:1},Me={class:"text-center p-2 mt-3"},$e=["disabled"],Ue={key:0,class:"animate-spin h-7 w-7 -mb-2 mr-3 pt-2 border-r-2 border-b-2 border-l-2 border-whtie rounded-full inline-block"},Ge={key:12,class:"text-center p-2 mt-3"},Pe=["disabled"],Qe={__name:"index",setup(Ee){const _=Y(),f=ue();let B=u({}),C=u({}),j=u({}),q=u({}),I=u(!1),d=u(!1),A=u(""),k=u(""),N=u(1);f.getBillerCat();const t=u({mobile_number:"",planId:null,phone:"",type:"cable",country:"NG",amount:"",face_amount:0,userId:_.details.track_id,transactionType:"tvcable-payment",paymentChannel:"arise_data",charge:.5,cable:null,cableId:"",planpackage:"",recipient:"",currency:_.details.currency});let y=u([]);const S=Z();ee(()=>{if(S.query.type){S.query.type.length>0&&(A.value=S.query.type);{let s=f.services.data.find(m=>m.service_name=="cable").service_suffix,n=f.services.data.find(m=>m.service_name=="cable").percentage.find(m=>m.user_type==_.details.type);if(N.value=n==null?0:n.value/100,Object.keys(f.cableServices).length>0){let m=A.value+""+s,b=f.cableServices[m];b.length>0&&(y.value=b.filter(a=>a.plan_type!="SME"))}}}});function F(){if(y.value.length>0){let s=y.value.filter(a=>a.id==t.value.planId)[0].cable,n=Number(y.value.filter(a=>a.id==t.value.planId)[0].plan_amount),m=y.value.filter(a=>a.id==t.value.planId)[0].planpackage;t.value.cableId=f.services.data.find(a=>a.service_name=="cable").services.find(a=>a.name==s).id,t.value.cable=s,t.value.face_amount=n,t.value.amount=Math.round(n+n*N.value);let b=re(t.value.amount);k.value=_.details.currency=="NGN"?`â‚¦${b}`:`$${b}`,t.value.planpackage=m,d.value=!1}}let p=u({}),g=u(!1),v=u({});async function L(){g.value=!0,p.value={};try{await f.validateBill(t.value).then(s=>{p.value=s,g.value=!1,_.getUserDetails(_.details.track_id)})}catch(s){p.value=s,g.value=!1}}let h=u(5),x=u(!1),D=u();const z=()=>{d.value=!0,D.value=setInterval(H,1e3)},W=()=>{clearInterval(D.value),d.value=!1,h.value=5,x.value=!1};E(h,()=>{h.value<=0&&(clearInterval(D.value),x.value=!0,M())});const H=()=>{h.value--};async function M(){d.value=!0;try{await f.createBill(t.value).then(s=>{d.value=!1,v.value=s})}catch(s){v.value=s,d.value=!1}finally{h.value=5,x.value=!1}}const $=te(()=>!!(d.value||g.value||p.value.status=="error"&&!I.value||t.value.bouquet=="null"));E(()=>S.query.type,s=>{t.value.recipient="",t.value.phone="",t.value.country="",t.value.amount="",t.value.planId=null,p.value={},v.value={},d.value=!1,g.value=!1});function U(){B.value=G(t.value.recipient),C.value=P(t.value.recipient,10),j.value=G(t.value.phone),q.value=P(t.value.phone,11)}return(s,n)=>{const m=Q,b=X;return o(),r("div",null,[V(m),l("div",ie,[l("div",de,[V(b,{disabler:e(d),class:"w-1/4 h-32",icon:"gotv.jpg",text:"GOTV",link:"dashboard-tvpayment",query:{type:"GOTV"}},null,8,["disabler"]),V(b,{disabler:e(d),class:"w-1/4 h-32",icon:"dstv.jpg",text:"DSTV",link:"dashboard-tvpayment",query:{type:"DSTV"}},null,8,["disabler"]),V(b,{disabler:e(d),class:"w-1/4 h-32",icon:"startimes.jpg",text:"STARTIME",link:"dashboard-tvpayment",query:{type:"STARTIME"}},null,8,["disabler"])]),l("div",ce,[l("form",{onSubmit:ae(M,["prevent"])},[l("div",me,[ve,w(l("select",{class:"p-3 rounded-md w-full ring-0 border border-gray-200","onUpdate:modelValue":n[0]||(n[0]=a=>e(t).planId=a),onChange:F},[be,(o(!0),r(se,null,ne(e(y),(a,J)=>(o(),r("option",{key:J,value:a.cableplan_id},c(a.package)+" "+c(("getAmount"in s?s.getAmount:e(oe))(Number(a.plan_amount),e(N))),9,fe))),128))],544),[[le,e(t).planId]])]),s.$route.query.type=="GOTV"?(o(),r("div",_e,[ye,w(l("input",{type:"text",onKeyup:U,"onUpdate:modelValue":n[1]||(n[1]=a=>e(t).recipient=a),id:"subject",class:"p-3 rounded-md w-full ring-0 border border-gray-200"},null,544),[[T,e(t).recipient]])])):i("",!0),s.$route.query.type!="GOTV"?(o(),r("div",ge,[he,w(l("input",{type:"text",onKeyup:L,"onUpdate:modelValue":n[2]||(n[2]=a=>e(t).recipient=a),id:"subject",class:"p-3 rounded-md w-full ring-0 border border-gray-200"},null,544),[[T,e(t).recipient]])])):i("",!0),e(g)?(o(),r("p",ke,"Validating...")):i("",!0),e(p).status=="error"?(o(),r("p",xe,c(e(p).message),1)):i("",!0),e(B).status?i("",!0):(o(),r("p",we,c(e(B).message),1)),e(C).status?i("",!0):(o(),r("p",Ie,c(e(C).message),1)),e(p).status=="success"?(o(),r("p",Se,c(e(p).message),1)):i("",!0),e(p).status=="success"?(o(),r("p",Ve,"Customer name :"+c(e(p).data.name),1)):i("",!0),e(p).status=="error"?(o(),r("p",Te,[R("Could not validate customer. "),l("span",{onClick:n[3]||(n[3]=a=>K(I)?I.value=!0:I=!0),class:"underline cursor-pointer text-blue-400"},"Proceed anyways.")])):i("",!0),l("div",Be,[Ce,w(l("input",{type:"text",disabled:!0,"onUpdate:modelValue":n[4]||(n[4]=a=>K(k)?k.value=a:k=a),id:"sender",class:"p-3 rounded-md w-full ring-0 border border-gray-200",placeholder:"3000"},null,512),[[T,e(k)]])]),l("div",je,[qe,w(l("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=a=>e(t).phone=a),onKeyup:U,id:"sender",class:"p-3 rounded-md w-full ring-0 border border-gray-200",placeholder:"09020801526"},null,544),[[T,e(t).phone]])]),e(j).status?i("",!0):(o(),r("div",Ne,c(e(j).message),1)),e(q).status?i("",!0):(o(),r("div",De,c(e(q).message),1)),e(v)?(o(),r("div",{key:11,class:O(["rounded-md p-3 mt-3",{"text-red-600 bg-red-600/[.2]":e(v).status=="error","text-green-600 bg-green-600/[.2]":e(v).status=="success"}])},[e(v).status=="error"?(o(),r("p",Oe,c(e(v).message),1)):i("",!0),e(v).status=="success"?(o(),r("p",Ae,c(e(v).message),1)):i("",!0)],2)):i("",!0),l("div",Me,[l("button",{disabled:e($),class:O([{"opacity-50":e($)},"p-3 px-10 bg-[#0f8B8D] w-full lg:w-1/2 text-white rounded-md font-bold text-md hover:bg-[#0a5556]"]),onClick:z},[e(d)?(o(),r("span",Ue)):i("",!0),R(" Make "+c(s.$route.query.type)+" Payment",1)],10,$e)]),e(d)?(o(),r("div",Ge,[l("button",{disabled:e(x),onClick:W,class:O([{"opacity-50":e(x)},"p-2 bg-black w-full lg:w-1/2 text-white rounded-md font-bold text-lg"])}," Cancel ("+c(e(h))+") ",11,Pe)])):i("",!0)],40,pe)])])])}}};export{Qe as default};
